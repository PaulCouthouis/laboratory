---
import { buildInvitationCardRepository } from '../../features/invitation/adapters/jwt';
import { buildReadInvitationCard } from '../../features/invitation/domain/input/queries';

import '@fontsource/pacifico'
import '@fontsource/poppins'

import pacifico from '../../fonts/pacifico-latin-400-normal.woff2'
import poppins from '../../fonts/poppins-latin-400-normal.woff2'

import Cover from '../../sections/cover.astro'
import Date from '../../sections/date.astro';
// import Drawer from '../sections/drawer.astro';
import Place from '../../sections/place.astro';
import Reply from '../../sections/reply.astro'
import Story from '../../sections/story.astro';

const { jwt } = Astro.params

const repository = buildInvitationCardRepository()
const readInvitationCard = buildReadInvitationCard(repository)

let members = new Array<string>()

try {
  const membersSet = readInvitationCard(jwt as string)
  members = Array.from(membersSet)
} catch {
  return Astro.redirect('/404')
}
---

<html data-theme="cupcake">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Moe & Paul: Ton Invitation au Mariage</title>
  </head>
  <body class="opacity-0 transition-opacity duration-1000">
    <!-- <Loader client:load> -->
      <Cover />
      <!-- <Drawer> -->
        <Story />
        <Date />
        <Place />
        <Reply {members} />
      <!-- </Drawer> -->
    <!-- </Loader> -->
  </body>
</html>

<script>
  document.fonts.ready.then(() => {
    const body = document.getElementsByTagName('body')[0]
    // body.classList.remove("hidden");
    body.style.opacity = 100
  })
</script>